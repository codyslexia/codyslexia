# Copyright (c) 2023-2024 Codyslexia
# @license MIT
# This source code is licensed under the MIT license found in the
# LICENSE file in the root directory of this source tree.

---
apiVersion: skaffold/v4beta10
kind: Config
metadata:
  name: codyslexia
requires:
  - configs: ['stack-core']
    path: ./libs/shared/infra/src/skaffold/stack.yaml
profiles:
  - name: dev
    activation:
      - command: dev
      - kubeContext: docker-desktop
    requiresAllActivations: true
    manifests:
      rawYaml:
        - .nexa/**/k8s/*.yaml
      kustomize:
        buildArgs: []
        paths:
          # - .nexa/skaffold/dev # ?
          - libs/shared/infra/src/kustomize/overlays/dev
    deploy:
      kubeContext: docker-desktop
      kubectl:
        defaultNamespace: dev
        remoteManifests:
          - libs/shared/infra/src/kustomize/overlays/dev
      helm: {}
    build:
      local:
        concurrency: 1
        push: false
        useDockerCLI: true
      tagPolicy:
        sha256: {}
      artifacts:
        - image: ghcr.io/codyslexia/faker-api
          context: .
          docker:
            dockerfile: .nexa/faker-api/Dockerfile
        - image: ghcr.io/codyslexia/goapi
          context: .
          docker:
            dockerfile: apps/backend/goapi/Dockerfile
        - image: ghcr.io/codyslexia/qrcode-api
          context: .
          docker:
            dockerfile: .nexa/qrcode-api/Dockerfile
        - image: ghcr.io/codyslexia/rustapi
          context: apps/backend/rustapi
          docker:
            dockerfile: apps/backend/rustapi/Dockerfile
        - image: ghcr.io/codyslexia/totp-api
          context: .
          docker:
            dockerfile: .nexa/totp-api/Dockerfile
